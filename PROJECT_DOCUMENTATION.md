# توثيق مشروع منصة The Prof التعليمية

## نظرة عامة

منصة The Prof هي منصة تعليمية متكاملة تهدف إلى توفير محتوى تعليمي آمن للطلاب. تتيح المنصة للمعلمين إضافة دروس وشهور دراسية، وللطلاب شراء الشهور ومشاهدة الدروس وتحميل الملفات وأداء الامتحانات.

## الميزات الرئيسية

1. **نظام المصادقة والتفويض**:
   - تسجيل دخول للطلاب والمعلمين
   - حماية المسارات باستخدام JWT
   - تحقق من صلاحيات الوصول

2. **إدارة المحتوى التعليمي**:
   - إضافة وعرض الشهور الدراسية
   - إضافة وعرض الدروس
   - ربط الدروس بالشهور والمراحل الدراسية

3. **نظام الاشتراكات**:
   - شراء الشهور الدراسية
   - التحقق من الاشتراكات قبل الوصول إلى المحتوى

4. **مشغل فيديو آمن**:
   - عرض الفيديوهات بطريقة آمنة
   - منع الوصول المباشر إلى روابط الفيديو
   - تشفير بيانات الفيديو

5. **إدارة الملفات والامتحانات**:
   - تحميل ملفات PDF للدروس
   - الوصول إلى امتحانات الدروس

6. **نظام أمان متقدم**:
   - تشفير البيانات
   - تشويش الكود
   - كشف ومنع محاولات التلاعب

## الهيكل التقني

### التقنيات المستخدمة

- **الواجهة الخلفية (Backend)**:
  - Node.js
  - Express.js
  - MongoDB (مع Mongoose)
  - JWT للمصادقة

- **الواجهة الأمامية (Frontend)**:
  - EJS (قوالب)
  - JavaScript
  - CSS
  - HTML

- **الأمان**:
  - تشفير AES-256
  - تشويش الكود
  - توقيعات HMAC
  - منع أدوات المطور

### هيكل المشروع

```
theProfApi/
├── app.js                  # نقطة الدخول الرئيسية للتطبيق
├── package.json            # تبعيات المشروع
├── middlewares/            # الوسائط البرمجية
│   └── authMiddleware.js   # وسيط المصادقة
├── models/                 # نماذج قاعدة البيانات
│   ├── Student.js          # نموذج الطالب
│   └── Teacher.js          # نموذج المعلم
├── public/                 # الملفات الثابتة
│   ├── css/                # أنماط CSS
│   ├── js/                 # ملفات JavaScript
│   └── images/             # الصور
├── routes/                 # مسارات API
│   ├── auth.js             # مسارات المصادقة
│   ├── student.js          # مسارات الطالب
│   └── teacher.js          # مسارات المعلم
├── views/                  # قوالب EJS
│   ├── auth/               # صفحات المصادقة
│   ├── student/            # صفحات الطالب
│   ├── teacher/            # صفحات المعلم
│   └── partials/           # أجزاء مشتركة
└── logs/                   # سجلات التطبيق
```

## نماذج قاعدة البيانات

### نموذج الطالب (Student)

```javascript
{
  _id: ObjectId,
  studentName: String,
  studentNumber: String,
  studentGrade: String,
  password: String,
  assignedTeacher: ObjectId,
  boughtMonths: [
    {
      monthId: Number,
      buyDate: Date
    }
  ],
  watchedClasses: [
    {
      classId: Number,
      watchDate: Date
    }
  ],
  role: String
}
```

### نموذج المعلم (Teacher)

```javascript
{
  _id: ObjectId,
  teacherName: String,
  teacherNumber: String,
  password: String,
  availableMonths: [
    {
      id: Number,
      name: String,
      grade: Number,
      pricOfMonth: Number
    }
  ],
  availableClasses: [
    {
      id: Number,
      title: String,
      description: String,
      grade: Number,
      monthId: Number,
      url: String,
      pdf: String,
      exams: String
    }
  ],
  role: String
}
```

## آلية الأمان المتقدمة

### 1. تشفير بيانات الفيديو

تستخدم المنصة تشفير AES-256 لحماية بيانات الفيديو:

```javascript
function encryptData(data) {
  // مفتاح التشفير
  const encryptionKey = 'secure_video_encryption_key_must_be_32_chars';
  
  // إنشاء متجه التهيئة (IV)
  const iv = require('crypto').randomBytes(16);
  
  // إنشاء مشفر
  const cipher = require('crypto').createCipheriv('aes-256-cbc', Buffer.from(encryptionKey), iv);
  
  // تشفير البيانات
  let encrypted = cipher.update(data, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  // دمج IV مع البيانات المشفرة
  return iv.toString('hex') + ':' + encrypted;
}
```

### 2. مشغل الفيديو الآمن

يستخدم المشغل تقنيات متعددة لمنع الوصول غير المصرح به:

- تشفير روابط الفيديو
- إخفاء مصدر الفيديو في HTML
- منع النقر اليمين والنسخ
- إضافة طبقات حماية متعددة
- مراقبة محاولات التلاعب

### 3. تشويش الكود

يتم تشويش الكود JavaScript لمنع فهمه وتعديله:

```javascript
class CodeObfuscator {
  static obfuscateCode(code) {
    // إضافة تعليقات مضللة
    // إضافة متغيرات وهمية
    // إضافة وظائف مضادة للتصحيح
    // ...
  }
}
```

### 4. كشف أدوات المطور

تستخدم المنصة تقنيات متعددة لكشف ومنع استخدام أدوات المطور:

- مراقبة تغير حجم النافذة
- استخدام debugger للكشف عن أدوات المطور
- منع مفاتيح اختصار أدوات المطور
- تسجيل محاولات التلاعب

### 5. توقيعات أمنية

تستخدم المنصة توقيعات HMAC للتحقق من صحة البيانات:

```javascript
const signature = require('crypto')
  .createHmac('sha256', 'secret_key')
  .update(data)
  .digest('hex');
```

## تدفق العمل

### تسجيل دخول الطالب

1. الطالب يدخل رقم الطالب وكلمة المرور
2. الخادم يتحقق من صحة البيانات
3. الخادم ينشئ رمز JWT ويخزنه في ملف تعريف الارتباط
4. الطالب يتم توجيهه إلى لوحة التحكم

### شراء شهر دراسي

1. الطالب يتصفح الشهور المتاحة
2. الطالب يختار شهر للشراء
3. الخادم يتحقق من صلاحية الطلب
4. الخادم يضيف الشهر إلى قائمة الشهور المشتراة للطالب
5. الطالب يتم توجيهه إلى صفحة تفاصيل الشهر

### مشاهدة فيديو درس

1. الطالب يتصفح الدروس في شهر مشترى
2. الطالب يختار درس للمشاهدة
3. الخادم يتحقق من شراء الشهر المرتبط بالدرس
4. الخادم يشفر بيانات الفيديو ويرسلها إلى العميل
5. مشغل الفيديو الآمن يفك تشفير البيانات ويعرض الفيديو
6. المشغل يمنع الوصول المباشر إلى رابط الفيديو

## إرشادات التطوير

### إعداد بيئة التطوير

1. تثبيت Node.js و npm
2. استنساخ المستودع
3. تثبيت التبعيات: `npm install`
4. إنشاء ملف `.env` بمتغيرات البيئة
5. تشغيل الخادم: `npm run dev`

### إضافة ميزة جديدة

1. إنشاء مسار API في الملف المناسب
2. إنشاء نموذج قاعدة بيانات إذا لزم الأمر
3. إنشاء قالب EJS للواجهة الأمامية
4. إضافة أنماط CSS وكود JavaScript
5. اختبار الميزة

### نشر التطبيق

1. إعداد قاعدة بيانات MongoDB
2. تكوين متغيرات البيئة للإنتاج
3. بناء الأصول الثابتة
4. نشر التطبيق على الخادم
5. تكوين HTTPS

## الخاتمة

منصة The Prof هي منصة تعليمية متكاملة توفر تجربة تعليمية آمنة وسلسة للطلاب والمعلمين. تستخدم المنصة تقنيات أمان متقدمة لحماية المحتوى التعليمي ومنع الوصول غير المصرح به.
